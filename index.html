<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Slideshow + Widgets</title>

  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-color:#0b0c10;

      /* Slideshow timings */
      --slide-duration: 6s;
      --transition-duration: 0.5s;

      /* Global widget scale + margins (screen-px) */
      --ui-scale: 2.0;
      --left-top-gap: 720px;
      --right-top-gap: 720px;
      --left-gap: 60px;
      --right-gap: 60px;

      /* Card widths (unscaled logical px) */
      --widget-width: 200px;  /* Weather / Time / AQI */
      --news-width:   200px;  /* News / QR / Calendar / Extras */

      /* Per-widget widths (you can tweak individually) */
      --w-calendar: 200px;
      --w-time:     200px;
      --w-news:     200px;
      --w-weather:  200px;
      --w-aqi:      200px;
      --w-qr:       200px;

      /* Bottom mini cards (individual widths) */
      --w-extra1:   260px;
      --w-extra2:   300px;
      --w-extra3:   300px;
      --w-extra4:   160px; /* ‚Üì narrower HDMI */

      /* Per-widget min-heights (optional) */
      --h-calendar: 120px;
      --h-time:     120px;
      --h-news:     260px;
      --h-weather:  180px;
      --h-aqi:      140px;
      --h-qr:       220px;

      /* Bottom widgets equal height */
      --h-bottom:   140px;

      /* Logo placement (top-center) */
      --logo-top-gap:  250px;
      --logo-height:   40px;

      /* Bottom widgets row */
      --bottom-gap: 80px; /* distance from bottom edge for the 4 new boxes */
    }

    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:400 14px/1.4 Manrope,system-ui,sans-serif;overflow:hidden}
    .stage{ position:fixed; inset:0; overflow:hidden; background:var(--bg-color); }

    canvas{
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%); width:auto; height:auto; display:block; z-index:0;
    }
    .vignette::after{ content:""; position:absolute; inset:0; pointer-events:none;
      background:radial-gradient(120% 120% at 50% 60%, transparent 45%, rgba(0,0,0,0.28) 100%); mix-blend-mode:multiply; }

    .badge{ position:absolute; right:24px; bottom:20px; color:#fff; opacity:0; font:200 14px Manrope,sans-serif; }
    @media (prefers-reduced-motion:reduce){ :root{ --transition-duration:0s; } }

    /* ===== Logo (TOP‚ÄìCENTER) ===== */
    .logo-wrap{
      position:fixed;
      top:var(--logo-top-gap);
      left:50%;
      transform:translateX(-50%);
      z-index:1200;
      pointer-events:none;
    }
    .logo-wrap img{ height:var(--logo-height); width:auto; display:block; }

    .logo-caption{
      position:fixed;
      top:var(--logo-top-gap);
      left:var(--left-gap);
      z-index:1200;
      font-size:40px;
      font-weight:400;
      color:#ffffff;
      line-height:1;
      pointer-events:none;
      transform: translateY(4px);
    }

    /* ===== LEFT column ===== */
    .widgets-left{
      position:fixed;
      top:calc((var(--left-top-gap) + var(--logo-height) + 10px) / var(--ui-scale));
      left:calc(var(--left-gap) / var(--ui-scale));
      z-index:1000; pointer-events:auto;
      display:flex; flex-direction:column; gap:14px; align-items:flex-start;
      transform:scale(var(--ui-scale)) translateZ(0);
      transform-origin:top left;
    }

    /* ===== RIGHT column ===== */
    .widgets-right{
      position:fixed;
      top:calc(var(--right-top-gap) / var(--ui-scale));
      right:calc(var(--right-gap) / var(--ui-scale));
      z-index:1000; pointer-events:auto;
      display:flex; flex-direction:column; gap:14px; align-items:flex-end;
      transform:scale(var(--ui-scale)) translateZ(0);
      transform-origin:top right;
    }

    /* ===== New bottom row of 4 boxes ===== */
    /* ===== Bottom row of 4 boxes (FIXED) ===== */
.widgets-bottom{
  position:fixed;
  left:50%;
  bottom:var(--bottom-gap);
  transform:translateX(-50%) scale(var(--ui-scale));
  transform-origin:bottom center;
  z-index:1000;
  display:flex; gap:14px; align-items:stretch;
}

.widgets-bottom .card{
  height:var(--h-bottom);
  display:flex;
  padding:10px;                 /* a bit less padding */
  box-sizing:border-box;
  overflow:hidden;              /* keep inner box inside rounded corners */
}

/* individual widths */
#extra1{ width:var(--w-extra1) !important; height:var(--h-bottom) !important; }
#extra2{ width:var(--w-extra2) !important; height:var(--h-bottom) !important; }
#extra3{ width:var(--w-extra3) !important; height:var(--h-bottom) !important; }
#extra4{ width:var(--w-extra4) !important; height:var(--h-bottom) !important; }  /* HDMI narrower */

.widgets-bottom .mini{
  flex:1;
  height:100%;
  display:flex; align-items:center; gap:10px;
  padding:10px;                 /* inner padding trimmed too */
  box-sizing:border-box;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
  border-radius:16px;
  overflow:hidden;              /* no bleed */
}

/* text stays inside & wraps neatly */
.mini .mini-body{
  flex:1; min-width:0;          /* allow wrapping */
  display:flex; flex-direction:column; gap:4px;
  justify-content:center;
}
.mini .mini-head{ color:#b1b5c0; font-size:13px; letter-spacing:.2px; line-height:1.15; }
.mini .mini-line{
  color:#fff;
  font-size:15px;               /* slightly smaller */
  line-height:1.2;              /* tighter line height */
  word-break:break-word;
  overflow-wrap:anywhere;
}
.mini .mini-icon{
  flex:0 0 auto; width:36px; height:36px;
  display:grid; place-items:center;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:10px;
}
.mini .mini-icon svg{ width:22px; height:22px; }


    /* ===== Card base ===== */
    .card{
      border-radius:22px; padding:10px;
      background:rgba(18,20,24,.45);
      backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 8px 28px rgba(0,0,0,.25);
      font-weight:200; color:#eef1f5;
      width:var(--news-width);
    }
    .card-header{
      display:flex; justify-content:space-between; align-items:center;
      padding:8px 12px; margin:-2px -2px 10px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
      border-radius:16px; font-size:13px; letter-spacing:.3px;
      #aqiCity{ margin-left:auto; text-align:right; }
      #weatherCity{ margin-left:auto; text-align:right; }
      #newsSource{ margin-left:auto; text-align:right; }
    }
    .muted{opacity:.7}

    /* ===== Map per-widget width & height ===== */
    #calendarCard { width: var(--w-calendar); min-height: var(--h-calendar); }
    #timeCard     { width: var(--w-time);     min-height: var(--h-time); }
    #newsCard     { width: var(--w-news);     min-height: var(--h-news); }
    #weatherCard  { width: var(--w-weather);  min-height: var(--h-weather); }
    #aqiCard      { width: var(--w-aqi);      min-height: var(--h-aqi); }
    #qrCard       { width: var(--w-qr);       min-height: var(--h-qr); }

    /* Bottom mini-widgets: individual widths + enforced equal height */
    #extra1 { width: var(--w-extra1); height: var(--h-bottom); }
    #extra2 { width: var(--w-extra2); height: var(--h-bottom); }
    #extra3 { width: var(--w-extra3); height: var(--h-bottom); }
    #extra4 { width: var(--w-extra4); height: var(--h-bottom); } /* HDMI narrower */

    /* Make bottom cards act as containers so inner content fills height */
    .widgets-bottom .card { display:flex; }
    .widgets-bottom .mini { flex:1; height:100%; display:flex; gap:12px; align-items:flex-start; }

    /* ===== Weather ===== */
    #weatherCard{ width:var(--widget-width); }
    #weatherCard .weather-row{
      display:flex; flex-direction:column; gap:6px; align-items:flex-start;
      padding:10px 12px 12px; background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10); border-radius:16px; margin-bottom:10px;
    }
    #weatherCard .weather-icon{ font-size:24px; line-height:1; width:100%; text-align:center; margin-top:2px; }
    #weatherCard .weather-temp{ font-size:42px; line-height:1; font-weight:200; margin-top:2px; }
    #weatherCard .weather-desc{ font-size:13px; opacity:.92; }
    #weatherCard .weather-forecast{ display:grid; grid-template-columns:1fr; gap:8px; }
    #weatherCard .forecast-item{
      display:grid; grid-template-columns:1fr 56px 48px; align-items:center;
      padding:8px 10px; background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10); border-radius:14px;
    }
    #weatherCard .forecast-time{ font-size:12px; opacity:.9; }
    #weatherCard .wx{ display:grid; place-items:center; width:36px; height:32px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10); border-radius:10px;
      line-height:0; font-size:20px; transform:translateY(1px); }
    #weatherCard .forecast-temp{
      justify-self:end; font-size:13px; padding:6px 8px; min-width:42px; text-align:center;
      background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.12); border-radius:10px; opacity:.95;
    }

    /* ===== TIME ===== */
    #timeCard{ width:var(--widget-width); }
    .time-body{
      padding:12px; background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10); border-radius:16px;
      display:flex; flex-direction:column; gap:6px; align-items:flex-start;
    }
    .clock{
      font-weight:400; letter-spacing:.5px;
      display:flex; align-items:baseline; gap:6px;
    }
    .clock .hhmm{ font-size:36px; line-height:1; }
    .clock .ss{ font-size:16px; opacity:.85; }
    .clock .ampm{ font-size:14px; opacity:.85; }
    .clock-date{ display:none; }

    /* ===== AQI ===== */
    #aqiCard{ width:var(--widget-width); }
    #aqiCard .aqi-body{
      display:flex; flex-direction:column; gap:8px; align-items:center;
      padding:12px; background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10); border-radius:16px;
    }
    #aqiValue{ font-size:40px; line-height:1; }
    #aqiBadge{ font-size:12px; padding:4px 8px; border-radius:10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); line-height:1; }
    .aqi-bar{ width:100%; height:6px; border-radius:4px; background:linear-gradient(90deg,#2ecc71,#f1c40f,#e67e22,#e74c3c,#9b59b6,#7f1d1d); opacity:.75; position:relative; overflow:hidden; }
    .aqi-pointer{ position:absolute; top:-3px; width:2px; height:12px; background:#fff; border-radius:1px; opacity:.9; left:0%; }

    /* ===== News (with image) ===== */
    #newsCard{ width:var(--news-width); }
    #newsCard .card-header{ margin-bottom:6px; }
    .news-slide{
      position:relative; padding:10px 12px;
      background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); border-radius:16px; overflow:visible;
    }
    .news-media{ width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:12px; background:#222; margin-bottom:8px; }
    .news-title{
  font-size:18px;
  line-height:1.4;
  font-weight:400;
  margin:0 0 10px 0;
  color:#eef1f5;
  text-decoration:none;
  white-space:normal;        /* allow wrapping */
  overflow-wrap:break-word;  /* break long words if needed */
}

    .news-title:hover{ text-decoration:underline; }
    .news-meta{ font-size:12px; opacity:.85; display:flex; gap:8px; align-items:center; }
    .news-meta .dot{ width:4px; height:4px; background:#fff9; border-radius:2px; display:inline-block; }
    .news-fade-enter{ opacity:0; transform:translateY(6px); }
    .news-fade-leave{ opacity:0; transform:translateY(-6px); }
    .news-fade{ transition:opacity .35s ease, transform .35s ease; }
    .news-dots{ display:flex; gap:6px; justify-content:center; margin-top:10px; }
    .news-dot{ width:6px; height:6px; border-radius:3px; background:#fff6; cursor:pointer; transition:transform .2s ease, background .2s ease; }
    .news-dot.active{ background:#fff; transform:scale(1.25); }

    /* ===== QR ===== */
    #qrCard{ width:var(--news-width); }
    #qrCard .qr-body{
      display:flex; flex-direction:column; align-items:center; gap:10px;
      padding:12px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); border-radius:16px; text-align:center;
    }
    #qrImage{ width:100%; aspect-ratio:1/1; object-fit:contain; border-radius:12px; background:#fff; padding:10px; }
    #qrCaption{ font-size:13px; opacity:.9; }
    #qrLink{ color:#eef1f5; text-decoration:underline; }

    /* ===== Calendar (Today card) ===== */
    #calendarCard{ width:var(--news-width); }
    .cal-body{
      padding:12px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10); border-radius:16px;
    }

    /* ====== Bottom mini-widgets styling ====== */
    .mini{
      display:flex; gap:12px; align-items:flex-start;
      padding:12px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
    }
    .mini .mini-icon{
      flex:0 0 auto;
      width:36px; height:36px;
      display:grid; place-items:center;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:10px;
    }
    .mini .mini-icon svg{ width:22px; height:22px }
    .mini .mini-body{ display:flex; flex-direction:column; gap:4px }
    .mini .mini-head{ color:#b1b5c0; font-size:13px; letter-spacing:.2px }
    .mini .mini-line{ color:#ffffff; font-size:16px }
    .kbd{
      display:inline-block; padding:2px 6px; border-radius:6px;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18);
      font-size:13px; line-height:1.2; vertical-align:middle;
    }
  </style>
</head>
<body>
  <div class="stage vignette">
    <canvas id="glcanvas"></canvas>
    <div class="badge" id="badge"></div>

    <!-- TOP-CENTER LOGO -->
    <div class="logo-wrap"><img src="images/logo1.png" alt="Logo" id="logo1" /></div>
    <div class="logo-caption">CONFERENCE ROOM : BEEHIVE</div>

    <!-- LEFT column (DATE ‚Üí TIME ‚Üí NEWS) -->
    <div class="widgets-left">
      <!-- CALENDAR (Today) -->
      <div class="card" id="calendarCard">
        <div class="card-header"><span>Today</span></div>
        <div class="cal-body today-body">
          <div id="todayBadge" style="font-size:13px; padding:4px 10px; border-radius:10px;
            background:linear-gradient(135deg,#ff6a00,#ee0979); color:#fff; 
            font-weight:600; letter-spacing:0.3px; display:inline-block; margin-bottom:10px;">‚Äî</div>
          <div id="todayDay" style="font-size:40px; font-weight:200; line-height:1;">--</div>
          <div id="todayWeekday" style="font-size:14px; opacity:.85;">‚Äî</div>
        </div>
      </div>

      <!-- TIME -->
      <div class="card" id="timeCard">
        <div class="card-header"><span>Time</span><span id="tzName" class="muted">‚Äî</span></div>
        <div class="time-body">
          <div class="clock">
            <div class="hhmm" id="clockHHMM">--:--</div>
            <div class="ss"   id="clockSS">--</div>
            <div class="ampm" id="ampm">‚Äî</div>
          </div>
          <div class="clock-date" id="clockDate">‚Äî</div>
        </div>
      </div>

      <!-- NEWS -->
      <div class="card" id="newsCard">
        <div class="card-header"><span>Headlines</span><span id="newsSource">updating‚Ä¶</span></div>
        <div class="news-slide">
          <img id="newsImg" class="news-media" alt="" referrerpolicy="no-referrer">
          <div id="newsContainer" class="news-fade">
            <a id="newsLink" href="#" target="_blank" rel="noopener noreferrer" class="news-title">Loading headlines‚Ä¶</a>
            <div class="news-meta">
              <span id="newsSourceInline">‚Äî</span><span class="dot"></span><span id="newsTime">‚Äî</span>
            </div>
          </div>
          <div class="news-dots" id="newsDots"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT column (WEATHER ‚Üí AQI ‚Üí INSTAGRAM) -->
    <div class="widgets-right">
      <!-- Weather -->
      <div class="card" id="weatherCard">
        <div class="card-header">
          <span>Weather</span>
          <span id="weatherCity">Sultanpur, India</span>
        </div>
        <div class="weather-row">
          <div class="weather-icon" id="weatherIcon" aria-hidden="true">‚òÅÔ∏è</div>
          <div class="weather-main">
            <div class="weather-temp" id="weatherTemp">--¬∞</div>
            <div class="weather-desc" id="weatherDesc">Loading‚Ä¶</div>
          </div>
        </div>
        <div class="weather-forecast" id="weatherForecast"></div>
      </div>

      <!-- AQI -->
      <div class="card" id="aqiCard">
        <div class="card-header">
          <span>Air Quality</span><span id="aqiCity">Sultanpur, India</span>
        </div>
        <div class="aqi-body">
          <div id="aqiBadge">AQI ‚Äî</div>
          <div id="aqiValue">--</div>
          <div class="aqi-bar"><div class="aqi-pointer" id="aqiPointer"></div></div>
        </div>
      </div>

      <!-- Instagram QR -->
      <div class="card" id="qrCard">
        <div class="card-header"><span>Follow us on Instagram</span><span class="muted"></span></div>
        <div class="qr-body">
          <img id="qrImage" alt="QR to Instagram" />
          <div id="qrCaption">Scan or visit <a id="qrLink" href="https://www.instagram.com/mcbee.in/" target="_blank" rel="noopener noreferrer">instagram.com/mcbee.in</a></div>
        </div>
      </div>
    </div>

    <!-- BOTTOM ROW: Four mini-widgets -->
    <div class="widgets-bottom">
      <!-- 1) Screen Mirroring (Apple) -->
      <div class="card" id="extra1">
        <div class="mini">
          <div class="mini-icon">
            <!-- screen mirroring icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="12" rx="2"></rect>
              <path d="M8 20h8M10 16l2 2 2-2"></path>
            </svg>
          </div>
          <div class="mini-body">
            <div class="mini-head">Screen Mirroring</div>
            <div class="mini-line">From your Apple device</div>
            <div class="mini-line">Select <strong>BEEHIVE</strong></div>
          </div>
        </div>
      </div>

      <!-- 2) Windows with Miracast -->
      <div class="card" id="extra2">
        <div class="mini">
          <div class="mini-icon">
            <!-- Windows logo -->
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 4l8-1v9H3V4zm10-1l8-1v10h-8V3zM3 13h8v8l-8-1v-7zm10 0h8v9l-8-1v-8z"/>
            </svg>
          </div>
          <div class="mini-body">
            <div class="mini-head">Windows with Miracast</div>
            <div class="mini-line">Keyboard shortcut <span class="kbd">‚äû Win</span> + <span class="kbd">K</span></div>
            <div class="mini-line">Select <strong>BEEHIVE</strong></div>
          </div>
        </div>
      </div>

      <!-- 3) Connect Adapter -->
      <div class="card" id="extra3">
        <div class="mini">
          <div class="mini-icon">
            <!-- plug icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 7v6a4 4 0 0 0 8 0V7M9 7h8M12 3v4M16 3v4M7 13l-3 3M4 16H2"></path>
            </svg>
          </div>
          <div class="mini-body">
            <div class="mini-head">Connect Adapter</div>
            <div class="mini-line">Plug into your device</div>
            <div class="mini-line">Tap icon to pause/stop presenting</div>
          </div>
        </div>
      </div>

      <!-- 4) Wired (HDMI) -->
      <div class="card" id="extra4">
        <div class="mini">
          <div class="mini-icon">
            <!-- HDMI icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="8" width="18" height="6" rx="1.5"></rect>
              <path d="M7 8v6M10 8v6M14 8v6M17 8v6"></path>
            </svg>
          </div>
          <div class="mini-body">
            <div class="mini-head">Wired</div>
            <div class="mini-line">Use <br>the HDMI</div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
  /* ========= CONFIG ========= */
  const CITY_LABEL = "Sultanpur, India";
  const COORDS = { lat: 28.4959, lon: 77.1500 };
  const INSTA_URL = "https://www.instagram.com/mcbee.in/";
  const ANIMATION_MODE = 'crossfade';
  const RENDER_SCALE   = 1.00;

  const IMAGES = ["images/slide5.png","images/slide1.png","images/slide2.png","images/slide5.png","images/slide3.png","images/slide4.png","images/slide5.png","images/slide6.png","images/slide7.png","images/slide8.png"];    

  function cssVar(n){ return getComputedStyle(document.documentElement).getPropertyValue(n).trim(); }
  function readSeconds(n,f){ const v=cssVar(n), x=parseFloat((v||'').replace('s','')); return isFinite(x)?x*1000:f*1000; }

  const SLIDE_MS = readSeconds('--slide-duration', 6);
  const TRANSITION_MS = readSeconds('--transition-duration', 1.2);

  /* ========= WebGL slideshow ========= */
  const canvas=document.getElementById('glcanvas');
  const gl=canvas.getContext('webgl2',{premultipliedAlpha:true,antialias:true});
  function sizeGLBuffer(){ const vw=Math.max(1,Math.floor(innerWidth*RENDER_SCALE)), vh=Math.max(1,Math.floor(innerHeight*RENDER_SCALE)); canvas.width=vw; canvas.height=vh; gl.viewport(0,0,vw,vh); }
  function fitCanvas(){ canvas.style.width=innerWidth+'px'; canvas.style.height=innerHeight+'px'; }
  function resize(){ sizeGLBuffer(); fitCanvas(); } resize(); addEventListener('resize',resize);

  const vs=`#version 300 es
  precision highp float; const vec2 P[4]=vec2[4](vec2(-1.,-1.),vec2(1.,-1.),vec2(-1.,1.),vec2(1.,1.)); out vec2 uv;
  void main(){ vec2 p=P[gl_VertexID]; uv=p*0.5+0.5; gl_Position=vec4(p,0.,1.);} `;
  function fsFor(mode){
    if(mode==='crossfade') return `#version 300 es
      precision highp float; in vec2 uv; out vec4 frag; uniform sampler2D a,b; uniform vec2 res; uniform float t;
      vec2 cover(vec2 u, vec2 ts, vec2 rs){
        float rt=ts.x/ts.y, rc=rs.x/rs.y;
        if(rt>rc){ float s=rt/rc; u.y=(u.y-.5)*s+.5; } else { float s=rc/rt; u.x=(u.x-.5)*s+.5; }
        return u;
      }
      void main(){
        vec2 s0=vec2(textureSize(a,0)), s1=vec2(textureSize(b,0));
        vec4 c0=texture(a,cover(uv,s0,res)), c1=texture(b,cover(uv,s1,res));
        frag=mix(c0,c1,clamp(t,0.,1.));
      }`;
    if(mode==='wipe') return `#version 300 es
      precision highp float; in vec2 uv; out vec4 frag; uniform sampler2D a,b; uniform vec2 res; uniform float t;
      vec2 cover(vec2 u, vec2 ts, vec2 rs){
        float rt=ts.x/ts.y, rc=rs.x/rs.y;
        if(rt>rc){ float s=rt/rc; u.y=(u.y-.5)*s+.5; } else { float s=rc/rt; u.x=(u.x-.5)*s+.5; }
        return u;
      }
      void main(){
        vec2 s0=vec2(textureSize(a,0)), s1=vec2(textureSize(b,0));
        vec4 c0=texture(a,cover(uv,s0,res)), c1=texture(b,cover(uv,s1,res));
        float e=.01; float m=smoothstep(t-e,t+e,uv.x);
        frag=mix(c0,c1,m);
      }`;
    return `#version 300 es
      precision highp float; in vec2 uv; out vec4 frag; uniform sampler2D a,b; uniform vec2 res; uniform float t;
      vec2 cover(vec2 u, vec2 ts, vec2 rs){
        float rt=ts.x/ts.y, rc=rs.x/rs.y;
        if(rt>rc){ float s=rt/rc; u.y=(u.y-.5)*s+.5; } else { float s=rc/rt; u.x=(u.x-.5)*s+.5; }
        return u;
      }
      void main(){
        vec2 s0=vec2(textureSize(a,0)), s1=vec2(textureSize(b,0));
        vec4 c0=texture(a,cover(uv,s0,res)), c1=texture(b,cover(uv,s1,res));
        frag = (t<.999)?c0:c1;
      }`;
  }
  function compile(t,src){ const s=gl.createShader(t); gl.shaderSource(s,src); gl.compileShader(s); if(!gl.getShaderParameter(s,gl.COMPILE_STATUS)) throw new Error(gl.getShaderInfoLog(s)); return s; }
  function program(vsSrc,fsSrc){ const p=gl.createProgram(); gl.attachShader(p,compile(gl.VERTEX_SHADER,vsSrc)); gl.attachShader(p,compile(gl.FRAGMENT_SHADER,fsSrc)); gl.linkProgram(p); if(!gl.getProgramParameter(p,gl.LINK_STATUS)) throw new Error(gl.getProgramInfoLog(p)); return p; }
  const prog=program(vs,fsFor(ANIMATION_MODE)); gl.useProgram(prog);
  const loc={a:gl.getUniformLocation(prog,'a'), b:gl.getUniformLocation(prog,'b'), res:gl.getUniformLocation(prog,'res'), t:gl.getUniformLocation(prog,'t')};
  gl.bindVertexArray(gl.createVertexArray());
  function makeTex(img){ const t=gl.createTexture(); gl.bindTexture(gl.TEXTURE_2D,t); gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR); gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR); gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE); gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE); gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,true); gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,gl.NONE); gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,img); return t; }
  function loadImg(src){ return new Promise((res,rej)=>{ const i=new Image(); i.crossOrigin='anonymous'; i.onload=()=>res(i); i.onerror=rej; i.src=src; }); }
  let tex=[], idx=0, next=1, phase='dwell', end=performance.now();
  (async()=>{ try{ const imgs=await Promise.all(IMAGES.map(loadImg)); tex=imgs.map(makeTex);}catch{ const t=gl.createTexture(); gl.bindTexture(gl.TEXTURE_2D,t); gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])); tex=[t,t]; } start();})();

  function bind(i0,i1){ gl.activeTexture(gl.TEXTURE0); gl.bindTexture(gl.TEXTURE_2D,tex[i0%tex.length]); gl.uniform1i(loc.a,0); gl.activeTexture(gl.TEXTURE1); gl.bindTexture(gl.TEXTURE_2D,tex[i1%tex.length]); gl.uniform1i(loc.b,1); }
  function start(){ bind(idx,next); phase='dwell'; end=performance.now()+SLIDE_MS; gl.uniform1f(loc.t,0);
    requestAnimationFrame(loop);
    initWeatherAndAQI(); initNews(); initQR(); initClock(); renderCalendar(new Date());
  }
  function loop(now){ gl.uniform2f(loc.res,canvas.width,canvas.height);
    if(now>=end){ if(phase==='dwell'){ phase='transition'; end=now+TRANSITION_MS; bind(idx,next);} else { idx=next; next=(idx+1)%tex.length; bind(idx,next); phase='dwell'; end=now+SLIDE_MS; gl.uniform1f(loc.t,0);} }
    gl.uniform1f(loc.t, phase==='transition' ? 1 - Math.max(0,(end-now))/Math.max(1,TRANSITION_MS) : 0 );
    gl.drawArrays(gl.TRIANGLE_STRIP,0,4); requestAnimationFrame(loop);
  }

  /* ========= Weather + AQI ========= */
  async function initWeatherAndAQI(){
    document.getElementById('weatherCity').textContent = CITY_LABEL;
    document.getElementById('aqiCity').textContent     = CITY_LABEL;
    try{
      const wurl=`https://api.open-meteo.com/v1/forecast?latitude=${COORDS.lat}&longitude=${COORDS.lon}&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&timezone=auto`;
      const w=await fetch(wurl,{cache:'no-cache'}).then(r=>r.json());
      renderWeather(w);
      await fetchAQI(COORDS.lat,COORDS.lon);
    }catch{ document.getElementById('weatherDesc').textContent='Weather unavailable'; }
  }
  function wxIcon(c){ if(c===0)return'‚òÄÔ∏è'; if([1,2].includes(c))return'üå§Ô∏è'; if(c===3)return'‚òÅÔ∏è'; if([45,48].includes(c))return'üå´Ô∏è'; if([51,53,55,56,57].includes(c))return'üå¶Ô∏è'; if([61,63,65].includes(c))return'üåßÔ∏è'; if([66,67,71,73,75,77].includes(c))return'üå®Ô∏è'; if([80,81,82].includes(c))return'üåßÔ∏è'; if([95,96,99].includes(c))return'‚õàÔ∏è'; return'‚òÅÔ∏è'; }
  function wxText(c){ const m={0:'Clear',1:'Mostly clear',2:'Partly cloudy',3:'Cloudy',45:'Fog',48:'Rime fog',51:'Drizzle',53:'Drizzle',55:'Drizzle',56:'Freezing drizzle',57:'Freezing drizzle',61:'Rain',63:'Rain',65:'Heavy rain',66:'Freezing rain',67:'Freezing rain',71:'Snow',73:'Snow',75:'Heavy snow',77:'Snow grains',80:'Showers',81:'Showers',82:'Heavy showers',95:'Thunderstorm',96:'Thunderstorm',99:'Thunderstorm'}; return m[c]||'‚Äî'; }
  function renderWeather(d){
  const c = d.current;
  document.getElementById('weatherTemp').textContent = Math.round(c.temperature_2m) + '¬∞';
  document.getElementById('weatherDesc').textContent = wxText(c.weather_code);
  document.getElementById('weatherIcon').textContent = wxIcon(c.weather_code);

  // Remove the forecast completely
  const fc = document.getElementById('weatherForecast');
  fc.innerHTML = ''; // keep empty
}

  function aqiInfo(a){ if(a==null||!isFinite(a)) return {label:'‚Äî',color:'rgba(255,255,255,.12)',pos:0};
    if(a<=50) return{label:'Good',color:'#2ecc71',pos:(a/500)*100};
    if(a<=100)return{label:'Moderate',color:'#f1c40f',pos:(a/500)*100};
    if(a<=150)return{label:'Unhealthy (Sensitive)',color:'#e67e22',pos:(a/500)*100};
    if(a<=200)return{label:'Unhealthy',color:'#e74c3c',pos:(a/500)*100};
    if(a<=300)return{label:'Very Unhealthy',color:'#9b59b6',pos:(a/500)*100};
    return{label:'Hazardous',color:'#7f1d1d',pos:Math.min(100,(a/500)*100)}; }
  async function fetchAQI(lat,lon){
    try{
      const url=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&current=us_aqi,pm2_5,pm10`;
      const d=await fetch(url,{cache:'no-cache'}).then(r=>r.json());
      const a=d?.current?.us_aqi, info=aqiInfo(a);
      document.getElementById('aqiBadge').style.borderColor=info.color;
      document.getElementById('aqiBadge').style.boxShadow=`inset 0 0 0 1px ${info.color}22`;
      document.getElementById('aqiBadge').textContent=`AQI ${Math.round(a)}`;
      document.getElementById('aqiValue').textContent=Math.round(a);
      document.getElementById('aqiPointer').style.left=`${info.pos}%`;
    }catch{}
  }

  /* ========= NEWS (Times of India -> fallbacks) ========= */
  const NEWS_ROTATE_MS=10000;
  function prettyTime(ds){ if(!ds) return "just now"; const d=new Date(ds); if(isNaN(d)) return "‚Äî"; const s=(Date.now()-d)/1000; if(s<60) return "just now"; if(s<3600) return Math.floor(s/60)+"m ago"; if(s<86400) return Math.floor(s/3600)+"h ago"; return d.toLocaleDateString(); }

  async function fetchTOI(n=24){
    const feed = 'https://timesofindia.indiatimes.com/rssfeedstopstories.cms';
    const url = 'https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent(feed);
    const j = await fetch(url,{cache:'no-cache'}).then(r=>r.json());
    const items = j.items || [];
    return items.slice(0,n).map(it=>{
      let img = it.enclosure?.link || '';
      if(!img && it.content){
        const m = it.content.match(/<img[^>]+src=["']([^"']+)["']/i);
        if(m) img = m[1];
      }
      return {
        title: it.title,
        link: it.link,
        date: it.pubDate,
        source: 'Times of India',
        image: img || ''
      };
    });
  }

  async function fetchGuardian(n=24){
    const url='https://content.guardianapis.com/search?order-by=newest&section=(world|news|sport|culture|business)&show-fields=thumbnail,trailText,byline&page-size='+n+'&api-key=test';
    const j=await fetch(url,{cache:'no-cache'}).then(r=>r.json()); const a=j.response?.results||[];
    return a.map(r=>({title:r.webTitle, link:r.webUrl, date:r.webPublicationDate, source:'The Guardian', image:r.fields?.thumbnail||''}));
  }

  function cleanUrl(u){ return (u||'').replace(/&amp;/g,'&'); }
  async function fetchRedditNews(n=24){
    const j=await fetch(`https://www.reddit.com/r/news+worldnews/top.json?limit=${n}&t=day`,{cache:'no-cache'}).then(r=>r.json()); const p=j.data?.children||[];
    return p.map(({data})=>({ title:data.title, link:data.url_overridden_by_dest||('https://www.reddit.com'+data.permalink), date:data.created_utc?new Date(data.created_utc*1000).toISOString():'', source:'Reddit', image:cleanUrl(data.preview?.images?.[0]?.source?.url|| (data.thumbnail||'').startsWith('http')?data.thumbnail:'' ) }));
  }

  let newsList=[], newsIndex=0, newsTimer;
  function buildDots(){ const box=document.getElementById('newsDots'); box.innerHTML=''; newsList.forEach((_,i)=>{ const d=document.createElement('div'); d.className='news-dot'+(i===newsIndex?' active':''); d.onclick=()=>{ newsIndex=i; renderNews(); resetNewsTimer(); }; box.appendChild(d); }); }
  function updateDots(){ document.querySelectorAll('#newsDots .news-dot').forEach((el,i)=>el.classList.toggle('active',i===newsIndex)); }
  function setNewsSlide(it){
    const link=document.getElementById('newsLink'), src=document.getElementById('newsSourceInline'), tim=document.getElementById('newsTime'), hdr=document.getElementById('newsSource'), img=document.getElementById('newsImg');
    link.textContent=it.title||'‚Äî'; link.href=it.link||'#'; src.textContent=it.source||'‚Äî'; hdr.textContent=it.source||'Headlines'; tim.textContent=prettyTime(it.date);
    if(it.image){ img.src=it.image; img.style.display='block'; } else { img.removeAttribute('src'); img.style.display='none'; }
  }
  function renderNews(){ if(!newsList.length)return; const cont=document.getElementById('newsContainer'); cont.classList.add('news-fade-leave');
    setTimeout(()=>{ setNewsSlide(newsList[newsIndex]); cont.classList.remove('news-fade-leave'); cont.classList.add('news-fade-enter'); setTimeout(()=>cont.classList.remove('news-fade-enter'),130); updateDots(); },130);
  }
  function stepNews(){ if(!newsList.length)return; newsIndex=(newsIndex+1)%newsList.length; renderNews(); }
  function resetNewsTimer(){ clearInterval(newsTimer); newsTimer=setInterval(stepNews,NEWS_ROTATE_MS); }

  async function initNews(){
    let all=[];
    try{ all=await fetchTOI(24);}catch(e){ console.warn('TOI failed',e); }
    if(!all.length){ try{ all=await fetchGuardian(24);}catch(e){ console.warn('Guardian failed',e); } }
    if(!all.length){ try{ all=await fetchRedditNews(24);}catch(e){ console.warn('Reddit fallback failed',e); } }
    if(!all.length){ all=[{title:'No news feeds reachable right now.', link:'#', date:new Date().toISOString(), source:'Local', image:''}]; }
    all.sort((a,b)=>new Date(b.date)-new Date(a.date));
    newsList=all.slice(0,8); newsIndex=0; setNewsSlide(newsList[0]); buildDots(); resetNewsTimer();
  }

  /* ========= QR ========= */
  function initQR(){ const url=encodeURIComponent(INSTA_URL); document.getElementById('qrImage').src=`https://api.qrserver.com/v1/create-qr-code/?size=600x600&data=${url}`; document.getElementById('qrLink').href=INSTA_URL; }

  /* ========= Clock ========= */
  function pad(n){ return String(n).padStart(2,'0'); }
  function tickClock(){
    const d=new Date();
    let h=d.getHours(), m=d.getMinutes(), s=d.getSeconds();
    const ampm = h>=12?'PM':'AM'; const hh = ((h+11)%12)+1;
    document.getElementById('clockHHMM').textContent = `${pad(hh)}:${pad(m)}`;
    document.getElementById('clockSS').textContent   = pad(s);
    document.getElementById('ampm').textContent      = ampm;
    try{ document.getElementById('tzName').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone; }catch{}
  }
  function initClock(){ tickClock(); setInterval(tickClock,1000); }

  /* ========= Calendar (Today only) ========= */
  function renderCalendar() {
    const now = new Date();
    const weekday = now.toLocaleDateString(undefined,{ weekday: 'long' });
    const daynum  = now.getDate();
    const month   = now.toLocaleDateString(undefined,{ month: 'short' });

    document.getElementById('todayBadge').textContent = `${month} ${daynum}`;
    document.getElementById('todayDay').textContent = daynum;
    document.getElementById('todayWeekday').textContent = weekday;
  }
  </script>
</body>
</html>
